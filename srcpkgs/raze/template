# Template file for 'raze'
pkgname=raze
version=1.10.2
revision=1
archs="x86_64* aarch64*"
build_style=cmake
configure_args="-DINSTALL_PK3_PATH=share/raze -DDYN_GTK=OFF -DDYN_OPENAL=OFF"
hostmakedepends="pkg-config"
makedepends="SDL2-devel gtk+3-devel ZMusic-devel libopenal-devel libvpx-devel libgomp-devel"
short_desc="Build engine port backed by GZDoom tech"
maintainer="Mihail Ivanchev <contact@ivanchev.net>"
license="GPL-2.0-only, custom:BUILD"
homepage="https://raze.zdoom.org/"
distfiles="https://github.com/ZDoom/Raze/archive/refs/tags/${version}.tar.gz"
checksum=80f9b258271e316aca52751be8035eafc34fe2c6fa0e3a199206a5fe77be3406
nocross="gzdoom and raze cross-builds required tools from a native build"
repository=nonfree
restricted=yes

if [ "$XBPS_TARGET_LIBC" = musl ]; then
	CFLAGS="-DZ7_AFFINITY_DISABLE"
	makedepends+=" musl-fts-devel libexecinfo-devel"
fi

post_extract() {
	: >tools/updaterevision/UpdateRevision.cmake
	sed "
		s/@Tag@/${version}/;
		s/@Hash@/v${version}/;
		s/@Timestamp@/<unknown>/;
	" tools/updaterevision/gitinfo.h.in >source/gitinfo.h
}

post_install() {
	vlicense package/common/buildlic.txt
}
