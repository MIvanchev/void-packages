# Template file for 'cl-unicode'
pkgname=cl-unicode
version=0.1.6
revision=1
makedepends="sbcl cl-flexi-streams cl-ppcre"
depends="cl-ppcre"
short_desc="Portable Unicode library for Common Lisp"
maintainer="Mihail Ivanchev <contact@ivanchev.net>"
license="BSD-2-Clause"
homepage="https://github.com/edicl/cl-unicode.git"
distfiles="https://github.com/edicl/cl-unicode/archive/refs/tags/v${version}.tar.gz"
checksum=97166b51a4e1e4251393df1c7bea80cde783d1771fb6f7aa2a69665ce37fbbfd

_LIBRARY_DIR=usr/share/common-lisp/source/cl-unicode

# do_check() {
	# Taken out of .travis.yml
	#
	# Sadly in 0.1.6 the tests are expected to fail because of missing
	# properties. This is fixed on master so uncomment this ocde
	# once a new version is released.
	#
	# sbcl --non-interactive \
	#      --eval '(require "asdf")' \
	#      --eval "(push #p\"${wrksrc}/\" asdf:*central-registry*)" \
	#      --eval '(asdf:load-system "cl-unicode/test")' \
	#      --eval '(uiop:quit (if (cl-unicode-test:run-all-tests)
	#                           0 1))'
# }

do_build() {
	sbcl --non-interactive \
	     --eval '(require "asdf")' \
	     --eval "(push #p\"${wrksrc}/\" asdf:*central-registry*)" \
	     --eval '(asdf:load-system "cl-unicode/build")'
}

do_install() {
	vmkdir $_LIBRARY_DIR
	vcopy test $_LIBRARY_DIR
	vcopy *.lisp $_LIBRARY_DIR
	vcopy cl-unicode.asd $_LIBRARY_DIR
	vdoc docs/index.html
	# NOTE: Manually check license after this before submitting an update!
	sed -n "4,28p" alias.lisp | cut -c 5- > COPYING
	# Print conatenated copyright notices to stdout to inspect visually
	# in the build jobs.
	cat COPYING
	vlicense COPYING
}
