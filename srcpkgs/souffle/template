# Template file for 'souffle'
pkgname=souffle
version=2.4.1
revision=1
build_style=cmake
configure_args="-DCMAKE_BUILD_TYPE=Release \
 -DSOUFFLE_GIT=OFF \
 -DSOUFFLE_VERSION=${version} \
 -DPACKAGE_VERSION=${version}"
hostmakedepends="python3 flex"
makedepends="ncurses-devel zlib-devel sqlite-devel libffi-devel libgomp-devel"
short_desc="Variant of Datalog for tool designers crafting analyses in Horn clauses"
maintainer="Mihail Ivanchev <contact@ivanchev.net>"
license="UPL-1.0"
homepage="https://github.com/souffle-lang/souffle"
distfiles="https://github.com/souffle-lang/souffle/archive/refs/tags/${version}.tar.gz"
checksum=08d9b19cb4a8f570ac75dea73016b6a326d87ac28fccd4afeba217ace2071587

case "$XBPS_TARGET_MACHINE" in
	i686*) broken="It's currently unclear whether Souffle is supported on i686: https://github.com/souffle-lang/souffle/issues/2502" ;;
esac

post_patch() {
	# https://github.com/souffle-lang/souffle/issues/2503
	vsed -i tests/syntactic/CMakeLists.txt -e 's/positive_test(cpp_keywords)/#&/'
}

post_install() {
	vlicense LICENSE
}
