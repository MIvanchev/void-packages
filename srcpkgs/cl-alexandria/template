# Template file for 'cl-alexandria'
pkgname=cl-alexandria
version=1.4
revision=1
makedepends="texlive texinfo sbcl tar"
short_desc="Common Lisp utility library"
maintainer="Mihail Ivanchev <contact@ivanchev.net>"
license="Public Domain"
homepage="https://alexandria.common-lisp.dev/"
distfiles="https://gitlab.common-lisp.net/alexandria/alexandria/-/archive/v${version}/alexandria-v${version}.tar.gz"
checksum=0512aec38d054a20daa66e9983cf8a98151582d7e2307e49e8c1b4a61bbb779a

_LIBRARY_DIR=usr/share/common-lisp/source/alexandria

do_check() {
	sbcl --non-interactive \
		--eval '(require "asdf")' \
		--eval "(push #p\"${wrksrc}/\" asdf:*central-registry*)" \
		--eval '(asdf:test-system "alexandria-tests")'
}

do_build() {
	make -C doc html info pdf
}

do_install() {
	vmkdir $_LIBRARY_DIR
	vcopy alexandria-1 $_LIBRARY_DIR
	vcopy alexandria-2 $_LIBRARY_DIR
	vcopy alexandria.asd $_LIBRARY_DIR
	vinstall doc/alexandria.info 644 usr/share/info
	vdoc doc/alexandria.pdf
	vdoc doc/alexandria.html
	vlicense LICENCE
}
