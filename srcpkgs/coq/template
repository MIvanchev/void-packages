# Template file for 'coq'
pkgname=coq
version=8.19.0
revision=1
build_style="configure"
configure_args="-prefix /usr"
hostmakedepends="dune ocaml ocaml-findlib ocaml-num ocaml-zarith"
depends="ocaml-findlib"
short_desc="Proof assistant written in OCaml"
maintainer="Leah Neukirchen <leah@vuxu.org>"
license="LGPL-2.1-only"
homepage="https://coq.inria.fr"
distfiles="https://github.com/coq/coq/archive/V${version}.tar.gz"
checksum=17e5c10fadcd3cda7509d822099a892fcd003485272b56a45abd30390f6a426f
nopie=yes
nocross=yes

do_build() {
	make dunestrap
	if [ "${XBPS_TARGET_MACHINE%-musl}" = "i686" ]; then
		sed -i 's/\.cmxs/.cma/g' theories/dune
		sed -i 's/\.cmxs/.cma/g' user-contrib/Ltac2/dune
	fi
	dune build --display=short -p coq-core,coq-stdlib
}

do_install() {
	dune install coq-core coq-stdlib --prefix=/usr --destdir="$DESTDIR" \
		--mandir=/usr/share/man --docdir=/usr/share/doc
}
